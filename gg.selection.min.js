var ggSelection={},entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},clearText=function(e){return/\S/.test(e)?e.replace(/(\r\n|\n|\r)/gm," ").replace(/\s+/g," ").replace(/[&<>"'\/]/g,function(e){return entityMap[e]}):void 0},forbiddenTags=["script","style","frame","iframe","meta","link","img"],extractTextFromNode=function(e){for(var t=0;t<forbiddenTags.length;t++)$(forbiddenTags[t],e).remove();var n=e.innerHTML.replace(/</gm," <"),o=(new DOMParser).parseFromString(n,"text/html").body.innerText||"";return o=o.replace(/(\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ")},extractTextFromRange=function(e){var t="";try{for(var n=e.cloneContents(),o=n.children||n.childNodes,r=[],a=0,c=o.length;c>a;a++){var i=extractTextFromNode(o[a]);/\S/.test(i)&&r.push(i)}t=r.join(" ")}catch(l){window.console&&console.error(l),t=clearText(e.toString())}return t},getSelectionText=function(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),clearText(e)},getSelectedPhrase=function(){try{var e,t=[],n=[];if(window.getSelection){e=getSelection();for(var o=0,r=e.rangeCount;r>o;o++){var a=e.getRangeAt(o),c=a.startContainer,i=a.endContainer;c&&t.push("#text"===c.nodeName?c.parentNode:c),i&&t.push("#text"===i.nodeName?i.parentNode:i)}0===t.length&&(t=[e.anchorNode])}if(!t.length&&document.selection){e=document.selection;var l=e.getRangeAt?e.getRangeAt(0):e.createRange(),d=l.commonAncestorContainer?l.commonAncestorContainer:l.parentElement?l.parentElement():l.item(0);d&&(t=[d])}for(var o=0,g=t.length;g>o;o++){var d=t[o];"#text"==d.nodeName&&(d=d.parentNode);try{n.push(extractTextFromNode(d))}catch(s){window.console&&console.error(s),n.push($(d).text())}}return n.join(" ")}catch(s){window.console&&console.error(s)}},getAroundSelectedText=function(e){var t,n,o,r="",a="";return"undefined"!=typeof window.getSelection?(t=window.getSelection(),t.rangeCount?n=t.getRangeAt(0):(n=document.createRange(),n.collapse(!0)),o=document.createRange(),o.selectNodeContents(e),o.setEnd(n.startContainer,n.startOffset),r=extractTextFromRange(o),o.selectNodeContents(e),o.setStart(n.endContainer,n.endOffset),a=extractTextFromRange(o)):(t=document.selection)&&"Control"!=t.type&&(n=t.createRange(),o=document.body.createTextRange(),o.moveToElementText(e),o.setEndPoint("EndToStart",n),r=clearText(o.text||""),o.moveToElementText(e),o.setEndPoint("StartToEnd",n),a=clearText(o.text||"")),{before:r,after:a}};